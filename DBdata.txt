drop database tryeat;

CREATE DATABASE tryeat;

USE tryeat;

CREATE TABLE user(
	user_id INT(11) NOT NULL AUTO_INCREMENT,
	user_login_id VARCHAR(30) NOT NULL,
	user_pwd VARCHAR(50) NOT NULL,
	profile VARCHAR(100),
	signdate TIMESTAMP NOT NULL DEFAULT now(),
	PRIMARY KEY (user_id)
);

CREATE TABLE images (
	img_id INT(11) NOT NULL AUTO_INCREMENT,
	restaurant_id INT(11) NOT NULL,
	user_id INT(11) NOT NULL,
	image MEDIUMBLOB NOT NULL,
	PRIMARY KEY (img_id),
	FOREIGN KEY (user_id) REFERENCES user (user_id)
);

CREATE TABLE follow(
	follow_id INT(11) NOT NULL AUTO_INCREMENT,
	user_id INT(11) NOT NULL,
	target_id INT(11) NOT NULL,
	PRIMARY KEY (follow_id),
	KEY pkey (target_id),
	FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (target_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE restaurant(
	restaurant_id INT(11) NOT NULL AUTO_INCREMENT,
	img MEDIUMBLOB,
	restaurant_name VARCHAR(30) NOT NULL,
	locate_latitude DOUBLE NOT NULL,
	locate_longitude DOUBLE NOT NULL,
	restaurant_desc VARCHAR(100),
	open_time TIME,
	close_time TIME,
	review_count INT(11) NOT NULL,
	total_rate decimal(5,1) NOT NULL,
	PRIMARY KEY (restaurant_id)
);

CREATE TABLE review(
	review_id INT(11) NOT NULL AUTO_INCREMENT,
	restaurant_id INT(11) NOT NULL,
	user_id INT(11) NOT NULL,
	img MEDIUMBLOB,
	content TEXT,
	date TIMESTAMP NOT NULL DEFAULT now(),
	rate DECIMAL(2,1) NOT NULL,
	PRIMARY KEY (review_id),
	KEY pkey (user_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (user_id) REFERENCES user (user_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE ad(
	ad_id INT(11) NOT NULL AUTO_INCREMENT,
	restaurant_id INT(11) NOT NULL,
	ad_requester VARCHAR(100) NOT NULL,
	start_date TIMESTAMP NOT NULL DEFAULT now(),
	ad_period INT(11) NOT NULL,
	PRIMARY KEY (ad_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id)
);

CREATE TABLE rquest_update_restaurant(
	request_update_id INT(11) NOT NULL AUTO_INCREMENT,
	restaurant_id INT(11) NOT NULL,
	img_id INT(10),
	restaurant_name VARCHAR(30) NOT NULL,
	locate_latitude DOUBLE NOT NULL,
	locate_longitude DOUBLE NOT NULL,
	restaurant_desc VARCHAR(100),
	open_time TIME,
	close_time TIME,
	PRIMARY KEY (request_update_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id) ON DELETE CASCADE
);

CREATE TABLE rquest_delete_restaurant(
	request_delete_id INT(11) NOT NULL AUTO_INCREMENT,
	restaurant_id INT(11) NOT NULL,
	delete_content TEXT NOT NULL,
	PRIMARY KEY (request_delete_id),
	FOREIGN KEY (restaurant_id) REFERENCES restaurant (restaurant_id) ON DELETE CASCADE
);
USE tryeat;
������ ���� (18.05.08.22:27 ����)

USE tryeat;

������ �̸� �˻��ϴ� ����
 SELECT restaurant_name FROM restaurant;

restaurant_id ������ ��, ����ϴ� ����
 INSERT INTO review (restaurant_id,title,content,rate) VALUES ('restaurant_id','title','content','rate');
 
restaurant_id ������ �� ����, ����ϴ� ����
 UPDATE review SET title='title', content='content', rate='rate' WHERE review_id=restaurant_id;
 
restaurant_id �������� ���� ������ 1 ������Ű�� ����
 UPDATE restaurant SET review_count=review_count+1 WHERE restaurant_id=restaurant_id;
 
restaurant_id ������ �� �����ϴ� ����
 DELETE FROM review WHERE review_id=restaurant_id;
 
restaurant_id ������ �� �����ִ� ����
 SELECT * FROM review WHERE restaurant_id=restaurant_id;

restaurant_id ������ �� ������ ����ϴ� ����
 UPDATE review SET rate='rate' WHERE review_id=restaurant_id;


�������� �߰��ϴ� ����
 INSERT INTO restaurant (restaurant_name,locate_latitude,locate_longitude,restaurant_desc,review_count,open_time,close_time) VALUES ('restaurant_name','locate_latitude','locate_longitude','restaurant_desc','0','open_time','close_time');

restaurant_id ������ ������ �����ϴ� ����
 UPDATE restaurant SET restaurant_name='���� ��ġ', locate_latitude='locate_latitude', locate_longitude='locate_longitude', restaurant_desc='restaurant_desc', open_time='open_time', close_time='close_time' WHERE restaurant_id=restaurant_id;
 
restaurant_id �������� ���� ����� ����ϴ� ����
 SELECT avg(rate) FROM review WHERE restaurant_id=restaurant_id;
 
user_id ������ �ȷο� id���� �����ϴ� ����
 INSERT INTO follow (user_id,follow_id,target_id) VALUES ('user_id','follow_id','target_id');
 
user_id ������ �ȷο� id���� �����ϴ� ����
 DELETE FROM follow WHERE(user_id=user_id AND follow_id="follow_id");
 
user_id ������ �ȷο� ��� ������ ����
 SELECT * FROM follow WHERE user_id=user_id;
 
 
user_id ������ �� �׸� ������ ����
 SELECT * FROM review WHERE user_id=user_id;
 
user_id ������ ���� ������ ����� ������ ����
 SELECT restaurant_id FROM review WHERE user_id=user_id;

 
�������� ��Ͽ� �ִ��� Ȯ���ϴ� ����
�̸����� �˻�// SELECT restaurant_name FROM restaurant WHERE restaurant_name="restaurant_name";
����id�� �˻�// SELECT restaurant_id FROM restaurant WHERE restaurant_id=restaurant_id;
��ǥ�� �˻�  // SELECT (locate_latitude AND locate_longitude) as exist FROM restaurant WHERE (locate_latitude="locate_latitude" AND locate_longitude="locate_longitude");


restaurant_id �������� �̹����� �ҷ����� ����
 SELECT image FROM images WHERE 'restaurant_id' = restaurant_id;

restaurant_id ������ �̹����� ����, �߰��ϴ� ����
 INSERT INTO images (restaurant_id, image) VALUES ('restaurant_id', 'image');

restaurant_id �������� img_id �̹����� �����ϴ� ����
 DELETE FROM images WHERE img_id = img_id;
 
u_num�� ����� restaurant_id ������ �̹����� �������� ����
 SELECT image FROM images WHERE (user_id = user_id AND restaurant_id = restaurant_id);
 
u_num�� ����� restaurant_id ������ �̹����� ��� �����ϴ� ����
 DELETE FROM images WHERE (user_id = user_id AND restaurant_id = restaurant_id);

���� ad ����� �����ִ� ����
 SELECT * FROM ad;
 
ad_requester �� ����� restaurant_id �������� ����ϴ� ����
 SELECT restaurant_id FROM ad WHERE ad_requester = ad_requester;



